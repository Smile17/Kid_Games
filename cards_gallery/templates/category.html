{% load static %}

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="generator" content="">
    <title>Cards Gallery</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">

</head>
<body>

<header>

    <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container">
            <a href="{% url 'home' %}" class="navbar-brand d-flex align-items-center">
                <i class="fa fa-camera mr-3" aria-hidden="true"></i>
                <strong>Home</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader"
                    aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
</header>

<main>

    <section class="py-5 text-center container">
        <div class="row py-lg-5">
            <div class="col-lg-6 col-md-8 mx-auto">

                <h1 class="fw-light">{{category.title}}</h1>

            </div>
        </div>
    </section>

    <div class="album py-5 bg-light">
        <div class="container-xl">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3">

                {% if cards|length > 0 %}
                {% for card in cards %}
                <div class="col">
                    <div class="card shadow">
                        <img src="{{card.image.url}}" alt="{{card.altText}}">
                        <div class="overlay">{{card.title}}</div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <h2>No image for selected category</h2>
                {% endif %}

            </div>
        </div>
    </div>

</main>

<div class="sticky-button fixed-bottom container d-flex justify-content-end">
    <a href="#fullscreenModal" role="button" data-toggle="modal">
        <button class="btn btn-dark btn-circle btn-circle-lg m-1"><i class="fa fa-arrows-alt fa-lg"></i></button>
    </a>
</div>


<div class="modal fade" id="fullscreenModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-full" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{category.title}}</h5>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Ã—</button>
            </div>
            <div class="modal-body p-4" id="result">

                <div id="demo" class="carousel slide container" data-ride="carousel">

                    <!-- Indicators
                    <ul class="carousel-indicators">

                        {% for i in cards %}

                          {% if forloop.counter0 == 0 %}
                              <li data-target="#demo" data-slide-to="{{ forloop.counter0 }}" class="active"></li>
                          {% else %}
                              <li data-target="#demo" data-slide-to="{{ forloop.counter0 }}"></li>
                          {% endif %}

                        {% endfor %}

                    </ul>
                      -->
                    <!-- The slideshow -->
                    <div class="carousel-inner">

                        {% for card in cards %}

                        {% if not forloop.first %}
                        <div class="carousel-item">
                            <audio src="{{ card.audio.url }}" id="audio_{{forloop.counter0}}"></audio>
                            <div class="audio-btn" onclick="playAudio('audio_{{forloop.counter0}}')"><i
                                    class="fa fa-music fa-lg white" aria-hidden="true"></i></div>
                            <img src="{{card.image.url}}" alt="{{card.altText}}">
                        </div>
                        {% else %}
                        <div class="carousel-item active">
                            <audio src="{{ card.audio.url }}" id="audio_{{forloop.counter0}}"></audio>
                            <div class="audio-btn" onclick="playAudio('audio_{{forloop.counter0}}')"><i
                                    class="fa fa-music fa-lg white" aria-hidden="true"></i></div>
                            <img src="{{card.image.url}}" alt="{{card.altText}}">
                        </div>
                        {% endif %}


                        {% endfor %}

                    </div>

                    <!-- Left and right controls -->
                    <a class="carousel-control-prev" href="#demo" data-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </a>
                    <a class="carousel-control-next" href="#demo" data-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </a>

                </div>


            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

<script>
function playAudio(audio_id){
       document.getElementById(audio_id).play();
}

let allSlides = $("#demo").find('.carousel-item');

allSlides.each(function(index, el) {
  if (index !== 0) {
    $(this).find('audio')[0].pause();
  }
});
function playSlide(ev) {
  let slides = $(this).find('.carousel-item');
  let pvid = slides[ev.from].querySelectorAll('audio')[0];
  let vid = slides[ev.to].querySelectorAll('audio')[0];
  console.log(vid);
  let isPlaying = vid.currentTime > 0 && vid.readyState > 2;

  vid.play();

  if (isPlaying) {
    pvid.pause();
  }
}
$("#demo").on('slide.bs.carousel', playSlide);
function playSlide0(ev) {
  let slide = $("#demo").find('.carousel-item.active');
  if (slide.length > 0){
      let vid = slide[0].querySelectorAll('audio')[0];
      vid.play();
  }
}

$("#fullscreenModal").on('show.bs.modal', playSlide0);


</script>

</body>
</html>

<!--
Icons: https://fontawesome.com/v4/icons/
Circle buttons: https://bootstrapious.com/p/bootstrap-circle-button
 -->