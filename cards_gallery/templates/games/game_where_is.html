{% extends "base.html" %}

{% block navbar %}
{% endblock navbar %}

{% block content %}
<div class="sticky-button fixed-top container d-flex justify-content-end">
    <a href="{% url 'image-category'  slug %}">
        <i class="fa fa-times fa-lg text-dark" aria-hidden="true"></i>
    </a>
</div>

<main>
    <section class="py-3 text-center container">
        <div class="row py-lg-3">
            <div class="col-lg-6 col-md-8 mx-auto" onclick="playAudio('audio_answer')">
                <h1 class="fw-light">{{answer.title}}</h1>
                <audio src="{{ answer.audio.url }}" id="audio_answer" autoplay></audio>
            </div>
        </div>
    </section>
    <div class="progress">
      <div class="progress-bar bg-dark" role="progressbar" style="width: {{progress_width}}%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
<div class="bg-light">
    <div class="card-board">
        {% for card in cards %}
                <div id="{{card.slug}}" class="card card-item shadow" onclick="playAudio('audio_{{forloop.counter0}}')">
                        <img class="card-image" src="{{card.image.url}}" alt="{{card.altText}}">
                        <audio src="{{ card.audio.url }}" id="audio_{{forloop.counter0}}"></audio>
                 </div>
                {% endfor %}
    </div>
</div>
<!-- Sticky buttons -->
<div class="sticky-button fixed-bottom container d-flex justify-content-end">

        {% if next_progress < 100 %}
        <a id = "next-button" class = "text-light disabled" role="button" onclick="saveProgress()" href="{% url 'image-game' game_num slug %}">
            <button class="btn btn-dark btn-circle btn-circle-lg m-1 disabled">
                <i class="fa fa-chevron-right" aria-hidden="true"></i>
            </button>
        </a>
        {% else %}
          <a id = "next-button" class = "text-light disabled" role="button" onclick="saveProgress()" href="{% url 'image-category' slug %}">
            <button class="btn btn-dark btn-circle btn-circle-lg m-1 disabled">
                <i class="fa fa-trophy" aria-hidden="true"></i>
            </button>
          </a>
        {% endif %}
</div>

</main>
{% endblock content %}

{% block script %}
    <script>
         $('.card-item').click(function() {
         var next_button = document.getElementById('next-button');
         next_button.classList.remove('disabled');
         next_button.getElementsByTagName('button')[0].classList.remove('disabled');
         if(this.id == '{{answer.slug}}') {
            console.log('You are right');
         }
         else {
            console.log('You are wrong');
            $(this).css("outline","10px solid red");
         }
         document.getElementById('{{answer.slug}}').classList.add('selected-correct');
    });
    function saveProgress() {
        var key = {{game_num}} + '_num_visits';
        var num_visits = sessionStorage.getItem(key) || 0;
        sessionStorage.setItem(key, parseInt(num_visits) + 1);
        alert(key);
        alert(num_visits);
    }
    function playAudio(audio_id) {
            var audio = document.getElementById(audio_id);
            try {
                audio.play();
            } catch (e) {
                console.log(e);
            }
        }
    </script>
{% endblock script %}